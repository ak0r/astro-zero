---
import { siteConfig } from '@/site.config';
import Container from '@/components/layout/Container.astro';
import Icon from '@/components/common/IconWrapper.astro';
import Navigation from '@/components/layout/Navigation.astro';
import ThemeToggle from '@/components/widgets/ThemeToggle.astro';
import Avatar from '@/components/widgets/Avatar.astro';

const showProfilePicture = siteConfig.profilePicture.enabled && siteConfig.profilePicture.placement === 'header';
---
<header
  id="main-header"
  class="sticky top-0 inset-x-0 flex flex-wrap md:justify-start md:flex-nowrap z-50 w-full text-sm"
>
  <Container>
    <nav class="not-prose flex flex-wrap md:flex-nowrap relative w-full rounded-lg items-center justify-between border border-ui bg-surface/70 backdrop-blur-lg mt-4 p-3">

      <!-- LEFT: Logo -->
      <div class="flex items-center group shrink-0">
        <a href="/" class="group flex focus:outline-hidden">
          <!-- { showProfilePicture && <Avatar /> } -->
          <span class="font-semibold text-3xl link-animate">
            {siteConfig.title}
          </span>
        </a>
      </div>

      <!-- CENTER: Desktop Navigation -->
      <div class="hidden md:flex flex-1 py-2 md:gap-3 md:items-center md:justify-center">
        <Navigation />
      </div>

      <!-- RIGHT: Actions -->
      <div class="flex items-center ml-auto gap-2 shrink-0">

        <!-- Theme toggle (always visible) -->
        <ThemeToggle />

        <!-- Command palette -->
        {siteConfig.commandPaletteConfig.enabled && (
          <button
            id="command-palette-trigger"
            class="btn-icon flex items-center text-sm"
            aria-label="Open command palette"
            onclick="window.dispatchEvent(new CustomEvent('command-palette:open', { detail: { mode: 'command' } }))"
          >
            <Icon name="command" size={16} class="shrink-0" />
            <kbd class="sm:inline text-sm font-medium">
              K
            </kbd>
          </button>
        )}

        <!-- Mobile menu -->
        <button
          id="mobile-menu-toggle"
          class="md:hidden btn-icon flex items-center text-sm"
          aria-label="Toggle navigation"
          aria-expanded="false"
        >
          <span id="menu-icon">
            <Icon name="menu-2" size={16} class="shrink-0" />
          </span>
          <span id="close-icon" class="hidden">
            <Icon name="x" size={16} class="shrink-0" />
          </span>
        </button>

      </div>
    </nav>
  </Container>
</header>

<nav
  id="mobile-drawer"
  class="
    fixed inset-0 z-40
    bg-surface
    p-6 pt-30 text-lg
    translate-x-full
    h-screen
    transition-transform duration-300 ease-in-out
    md:hidden
    flex flex-col gap-6
  "
>
  <Navigation />
</nav>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('mobile-menu-toggle');
    const drawer = document.getElementById('mobile-drawer');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');

    toggle?.addEventListener('click', () => {
      const isOpen = !drawer.classList.contains('translate-x-full');

      drawer.classList.toggle('translate-x-full', isOpen);
      menuIcon.classList.toggle('hidden', !isOpen);
      closeIcon.classList.toggle('hidden', isOpen);
      toggle.setAttribute('aria-expanded', String(!isOpen));
    });

    drawer?.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        drawer.classList.add('translate-x-full');
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        toggle.setAttribute('aria-expanded', 'false');
      });
    });

    document.addEventListener('click', (e) => {
      const target = e.target;
      if (
        !target.closest('#mobile-drawer') &&
        !target.closest('#mobile-menu-toggle')
      ) {
        drawer.classList.add('translate-x-full');
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        toggle.setAttribute('aria-expanded', 'false');
      }
    });
  });
</script>
