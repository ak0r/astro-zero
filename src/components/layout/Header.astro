---
import { siteConfig } from '@/site.config';
import Container from '@/components/layout/Container.astro';
import Icon from '@/components/common/IconWrapper.astro';
import LinkWrapper from '@/components/common/LinkWrapper.astro';
import Navigation from '@/components/layout/Navigation.astro';

const showProfilePicture = siteConfig.profilePicture.enabled && siteConfig.profilePicture.placement === 'header';
const profilePicture = siteConfig.profilePicture;

const getHeaderProfilePictureClasses = (style: string) => {
  switch (style) {
    case 'circle': return 'w-8 h-8 rounded-full object-cover border-2 border-ui';
    case 'square': return 'w-8 h-8 rounded-lg object-cover border-2 border-ui';
    default: return 'h-8 object-contain';
  }
};

const currentPath = Astro.url.pathname;

---

<header
  id="main-header"
  class="sticky top-0 z-50 bg-surface/50 backdrop-blur-lg"
>
  <Container>
    <div class="not-prose flex items-center justify-between h-24 relative">

      <!-- Logo -->
      <a href="/" class="hover:opacity-75 transition-opacity">
        {showProfilePicture ? (
          <img
            src={profilePicture.image}
            alt={profilePicture.alt}
            class={getHeaderProfilePictureClasses(profilePicture.style)}
          />
        ) : (
          <span class="font-semibold text-2xl">
            {siteConfig.title}
          </span>
        )}
      </a>

      <!-- Mobile menu toggle -->
      <button
        id="mobile-menu-toggle"
        class="md:hidden p-2 hover:bg-ui rounded-lg transition-colors"
        aria-label="Toggle navigation"
        aria-expanded="false"
      >
        <span id="menu-icon">
          <Icon name="menu" size={20} />
        </span>
        <span id="close-icon" class="hidden">
          <Icon name="x" size={20} />
        </span>
      </button>

      <!-- Desktop navigation -->
      <nav class="hidden md:block">
        <Navigation />
      </nav>

    </div>
  </Container>
</header>

<nav
  id="mobile-drawer"
  class="
    fixed inset-0 z-40
    bg-surface
    p-6 pt-24
    translate-x-full
    transition-transform duration-300 ease-in-out
    md:hidden
  "
>
  <Navigation />
</nav>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('mobile-menu-toggle');
    const drawer = document.getElementById('mobile-drawer');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');

    toggle?.addEventListener('click', () => {
      const isOpen = !drawer.classList.contains('translate-x-full');

      drawer.classList.toggle('translate-x-full', isOpen);
      menuIcon.classList.toggle('hidden', !isOpen);
      closeIcon.classList.toggle('hidden', isOpen);
      toggle.setAttribute('aria-expanded', String(!isOpen));
    });

    drawer?.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        drawer.classList.add('translate-x-full');
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        toggle.setAttribute('aria-expanded', 'false');
      });
    });

    document.addEventListener('click', (e) => {
      const target = e.target;
      if (
        !target.closest('#mobile-drawer') &&
        !target.closest('#mobile-menu-toggle')
      ) {
        drawer.classList.add('translate-x-full');
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        toggle.setAttribute('aria-expanded', 'false');
      }
    });
  });
</script>
