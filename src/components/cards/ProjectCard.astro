---
/**
 * ProjectCard Component
 *
 * Card component for projects.
 * Composed from reusable card sub-components.
 */
import type { Project } from '@/types';
import { getContentDir } from '@/utils/commonFunctions';
import { resolveImageFromPath } from '@/utils/images';
import BaseCard from './BaseCard.astro';
import CardImage from '@/components/cards/CardImage.astro';
import CardBadges from '@/components/cards/CardBadges.astro';
import CardMeta from '@/components/cards/CardMeta.astro';
import CardFooter from '@/components/cards/CardFooter.astro';

interface Props {
  project: Project;
  showImage?: boolean;
  showDescription?: boolean;
  showTags?: boolean;
  showBadge?: boolean;
  showMeta?: boolean;
  eager?: boolean;
}

const {
  project,
  showImage = true,
  showDescription = true,
  showTags = true,
  showBadge = true,
  showMeta = true,
  eager = false,
} = Astro.props;

const { title, description, date, status, version, tags } = project.data;

// Process image
let coverImagePath = project.data.cover;
if (Array.isArray(coverImagePath)) {
  coverImagePath = coverImagePath[0];
}

const contentDir = project.filePath ? getContentDir(project.filePath) : undefined;
const coverImage = resolveImageFromPath(coverImagePath, { baseDir: contentDir });
const coverImageAlt = project.data.coverAlt || `Project: ${title}`;

const entryUrl = `/${project.collection}/${project.id}`;
---

<BaseCard href={entryUrl}>
  {/* Image */}
  {showImage && coverImage && (
    <Fragment slot="image">
      <CardImage
        src={coverImage}
        alt={coverImageAlt}
        aspectRatio="3:2"
        eager={eager}
      />
    </Fragment>
  )}

  {/* Badges */}
  {showBadge && (
    <Fragment slot="badge">
      <CardBadges
        status={status}
        version={version}
      />
    </Fragment>
  )}

  {/* Meta */}
  {showMeta && (
    <Fragment slot="meta">
      <CardMeta date={date} />
    </Fragment>
  )}

  {/* Title */}
  <Fragment slot="title">
    <h3 class="font-semibold text-content mb-2 group-hover:text-primary transition-colors line-clamp-2 leading-tight text-base">
      {title}
    </h3>
  </Fragment>

  {/* Description */}
  {showDescription && description && (
    <Fragment slot="description">
      <p class="text-sm text-content-3 line-clamp-3 leading-relaxed mb-4">
        {description}
      </p>
    </Fragment>
  )}

  {/* Tags */}
  {showTags && tags && tags.length > 0 && (
    <Fragment slot="tags">
      <div class="flex flex-wrap gap-2 mb-4">
        {tags.slice(0, 3).map((tag) => (
          <span class="badge">#{tag}</span>
        ))}
        {tags.length > 3 && (
          <span class="text-xs text-content-3">+{tags.length - 3}</span>
        )}
      </div>
    </Fragment>
  )}

  {/* Footer */}
  <CardFooter label="Read details" />
</BaseCard>
