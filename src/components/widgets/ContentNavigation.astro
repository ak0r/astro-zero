---
import type { Post } from '@/types';
import LinkWrapper from '@/components/common/LinkWrapper.astro';
import IconWrapper from '@/components/common/IconWrapper.astro';

interface Props {
  prevEntry?: Post;
  nextEntry?: Post;
  parentEntry?: Post;
}

const { prevEntry, nextEntry, parentEntry } = Astro.props;

const isSubpost = Boolean(parentEntry);

const getBasePath = (entry: Post): string =>
  entry.collection === 'posts' ? '/posts' : '/galleries';

// count how many nav items we will actually render
const navCount =
  (prevEntry ? 1 : 0) +
  (nextEntry ? 1 : 0) +
  (parentEntry ? 1 : 0);

const gridClass =
  navCount === 3
    ? 'sm:grid-cols-3'
    : navCount === 2
    ? 'sm:grid-cols-2'
    : 'sm:grid-cols-1';
---
<section class="mt-12 pt-8 border-t border-ui not-prose">
  <nav class={`grid grid-cols-1 gap-4 ${gridClass}`}>

    <!-- Previous -->
    {prevEntry && (
      <LinkWrapper
        href={`${getBasePath(prevEntry)}/${prevEntry.id}`}
        class="internal-link post-nav group flex items-center gap-4 card"
      >
        <IconWrapper
          name="arrow-left"
          class="shrink-0 size-5 text-content-3 transition-transform group-hover:-translate-x-1"
        />
        <div class="flex flex-col overflow-hidden text-left">
          <div class="text-xs mb-1 text-content-3">
            {isSubpost ? 'Previous Subpost' : 'Previous Post'}
          </div>
          <div class="text-sm text-content-2 text-balance truncate">
            {prevEntry.data.title}
          </div>
        </div>
      </LinkWrapper>
    )}

    <!-- Parent -->
    {parentEntry && (
      <LinkWrapper
        href={`${getBasePath(parentEntry)}/${parentEntry.id}`}
        class="internal-link post-nav group flex items-center justify-center gap-4 card"
      >
        <IconWrapper
          name="corner-left-up"
          class="shrink-0 size-5 text-content-3 transition-transform group-hover:-translate-y-1"
        />
        <div class="flex flex-col overflow-hidden text-center">
          <div class="text-xs mb-1 text-content-3">Parent Post</div>
          <div class="text-sm text-content-2 truncate">
            {parentEntry.data.title}
          </div>
        </div>
      </LinkWrapper>
    )}

    <!-- Next -->
    {nextEntry && (
      <LinkWrapper
        href={`${getBasePath(nextEntry)}/${nextEntry.id}`}
        class="internal-link post-nav group flex items-center justify-end gap-4 card"
      >
        <div class="flex flex-col overflow-hidden text-right">
          <div class="text-xs mb-1 text-content-3">
            {isSubpost ? 'Next Subpost' : 'Next Post'}
          </div>
          <div class="text-sm text-content-2 text-balance truncate">
            {nextEntry.data.title}
          </div>
        </div>
        <IconWrapper
          name="arrow-right"
          class="shrink-0 size-5 text-content-3 transition-transform group-hover:translate-x-1"
        />
      </LinkWrapper>
    )}

  </nav>
</section>
