---
/**
 * ThemeManager Component
 *
 * Initializes theme on page load. Must be included in BaseLayout.
 * Simplified for static sites - no hash-based cache busting needed.
 */
---
<script is:inline>
  ;(function initTheme() {
    const root = document.documentElement;
    const darkTheme = root.getAttribute('data-dark-theme') || 'dark';
    const lightTheme = root.getAttribute('data-light-theme') || 'light';
    const defaultTheme = root.getAttribute('data-theme') || 'auto';

    // Get stored preference
    const stored = localStorage.getItem('data-theme');

    // Apply system preference helper
    const applySystemTheme = () => {
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      root.setAttribute('data-theme', prefersDark ? darkTheme : lightTheme);
    };

    // Determine which theme to apply
    if (!stored) {
      // First visit - use default
      localStorage.setItem('data-theme', defaultTheme);
      if (defaultTheme === 'auto' || defaultTheme === 'system') {
        applySystemTheme();
      }
    } else if (stored === 'auto' || stored === 'system') {
      // Auto mode - follow system
      applySystemTheme();
    } else {
      // Explicit theme stored
      root.setAttribute('data-theme', stored);
    }

    // Listen for system preference changes when in auto mode
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
      const current = localStorage.getItem('data-theme');
      if (current === 'auto' || current === 'system') {
        applySystemTheme();
      }
    });
  })();
</script>
