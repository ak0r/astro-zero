---
import type { Post } from '@/types';
import { siteConfig, type PostCategory } from '@/site.config';
import IconWrapper from '@/components/common/IconWrapper.astro';
import { formatDate } from '@/utils/commonFunctions';

interface Props {
  entry: Post;
  showCategory?: boolean;
  showIcon?: boolean;
}

const { entry, showCategory = false, showIcon } = Astro.props;
const { title, date, category, featured } = entry.data;

// Get category config
const categoryConfig = siteConfig.categories[category as PostCategory];

// Determine icon
let icon = categoryConfig?.icon || 'file-text';
let iconColor = categoryConfig?.color ? `color: ${categoryConfig.color}` : 'color: var(--text-content-3)';
icon = featured ? 'star' : icon;

// Build URL using slug
const entryUrl = `/${entry.collection}/${entry.id}`;
---

<a 
  href={entryUrl}
  class="content-entry group link-card flex items-start gap-3 py-2 transition-colors not-prose"
  data-category={category}
>
  {showIcon && 
    <IconWrapper 
      name={icon} 
      size={20} 
      class={`flex-shrink-0 mt-0.5`}
      style={iconColor}
    />
  }
  
  <div class="flex-1 flex items-center justify-between gap-4 min-w-0">
    <div class="flex items-center gap-2 flex-wrap min-w-0">
      <span class="text-content-2 link-animate transition-colors truncate">
        {title}
      </span>
      {showCategory && categoryConfig && (
        <span 
          class="text-xs px-2 py-0.5 rounded border flex-shrink-0"
          style={`background-color: ${categoryConfig.color}20; color: ${categoryConfig.color}; border-color: ${categoryConfig.color}40;`}
        >
          {categoryConfig.title}
        </span>
      )}
    </div>
    <time 
      datetime={date.toISOString()}
      class="text-sm text-content-3 font-mono whitespace-nowrap flex-shrink-0"
    >
      {formatDate(date, 'monthDay')}
    </time>
  </div>
</a>