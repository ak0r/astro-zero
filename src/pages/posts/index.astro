---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Container from '@/components/layout/Container.astro';
import PageHeader from '@/components/layout/PageHeader.astro';
import FilterTabs from '@/components/layout/FilterTabs.astro';
import { getAllPosts, getTopLevelPosts, sortPostsByDate, getCategoryCounts } from '@/utils/getContent';
import { siteConfig, POST_CATEGORIES } from '@/site.config';
import { generateIndexSEO } from '@/utils/seo';
import SEO from '@/components/common/SEO.astro';
import ContentDisplay from '@/components/content/ContentDisplay.astro';


// Fetch all posts and galleries


const allPosts = await getAllPosts();
// const parentPosts = await getTopLevelPosts(allPosts);
const sortedPosts = await sortPostsByDate(allPosts);
const counts = getCategoryCounts(sortedPosts);

// Build filter tabs from category config
const tabs = [
  {
    label: 'All',
    href: '/posts',
    icon: 'layout-grid',
    count: allPosts.length,
  },
  ...POST_CATEGORIES.map(cat => ({
    label: siteConfig.categories[cat].title,
    href: `/posts/${cat}`,
    icon: siteConfig.categories[cat].icon,
    iconColor: siteConfig.categories[cat].color,
    count: counts[cat] || 0,
  })),
];

const seoData = generateIndexSEO('posts', Astro.url.href);
---

<BaseLayout>
  <SEO data={seoData} slot="seo" />
  <Container class="py-4 sm:py-8">

    <PageHeader
      title="Thinking out loud."
      description="This is my personal blog, a space where I share my thoughts, ideas and other interesting things I come across."
      breadcrumb={Astro.url.pathname}
    />
    
    <FilterTabs tabs={tabs} class="mb-8" />
    
    <ContentDisplay
      entries={sortedPosts}
      display="list"
      groupByYear={true}
      showDescription={false}
      showTags={false}
      showCategory={true}
    />
  </Container>
</BaseLayout>