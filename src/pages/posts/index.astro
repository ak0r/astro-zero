---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Container from '@/components/layout/Container.astro';
import PageHeader from '@/components/layout/PageHeader.astro';
import FilterTabs from '@/components/layout/FilterTabs.astro';
import YearGroup from '@/components/content/YearGroup.astro';
import { getAllPosts, getTopLevelPosts, sortPostsByDate, getPostsByYearSorted } from '@/utils/getContent';
import { getAllGalleries } from '@/utils/getGallery';
import { siteConfig } from '@/site.config';
import { getBreadcrumbsFromPath } from '@/utils/commonFunctions';
import Breadcrumbs from '@/components/widgets/Breadcrumbs.astro';

// Fetch all posts and galleries
const allPosts = await getAllPosts();
const parentPosts = await getTopLevelPosts(allPosts);
const sortedPosts = await sortPostsByDate(parentPosts);
const galleries = await getAllGalleries();

const allContent = [...sortedPosts, ...galleries];

// Combine and sort by date
const groupedPosts = await getPostsByYearSorted(allContent);

const indexPageFilters = siteConfig.pageFilters.indexPageFilters;

// Generate breadcrumbs for the page
const breadcrumbs = getBreadcrumbsFromPath(Astro.url.pathname);
---

<BaseLayout>
  <Container class="py-8">
    <Breadcrumbs items={breadcrumbs} class="my-6" />
    <PageHeader
      title="Thinking out loud."
      description="This is my personal blog, a space where I share my thoughts, ideas and other interesting things I come across."
    />
    
    <FilterTabs tabs={indexPageFilters} class="mb-12" />
    
    <div class="flex flex-col gap-16">
      {groupedPosts.map(([year, posts]) => (
        <YearGroup 
          year={parseInt(year)} 
          entries={posts}
        />
      ))}
    </div>
  </Container>
</BaseLayout>