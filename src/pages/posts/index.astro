---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import Container from '@/components/layout/Container.astro';
import PageHeader from '@/components/layout/PageHeader.astro';
import FilterTabs from '@/components/layout/FilterTabs.astro';
import YearGroup from '@/components/content/YearGroup.astro';
import type { Post } from '@/types';

// Fetch all posts and galleries
const posts = await getCollection('posts', ({ data }) => !data.draft);
const galleries = await getCollection('gallery', ({ data }) => !data.draft);

// Combine and sort by date
const allContent = [...posts, ...galleries].sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime()
);

// Group by year
const contentByYear = allContent.reduce((acc, item) => {
  const year = item.data.date.getFullYear();
  if (!acc[year]) acc[year] = [];
  acc[year].push(item);
  return acc;
}, {} as Record<number, Post[]>);

const years = Object.keys(contentByYear)
  .map(Number)
  .sort((a, b) => b - a);

// Filter tabs configuration
const filterTabs = [
  { label: 'All', href: '/posts', icon: 'layout-grid' },
  { label: 'Travel', href: '/posts/travel', icon: 'plane' },
  { label: 'Tech', href: '/posts/tech', icon: 'code' },
  { label: 'Galleries', href: '/galleries', icon: 'library-photo' },
];
---

<BaseLayout>
  <Container class="py-8">
    
    <PageHeader
      title="Thinking out loud."
      description="This is my personal blog, a space where I share my thoughts, ideas and other interesting things I come across."
    />
    
    <FilterTabs tabs={filterTabs} class="mb-12" />
    
    <div class="flex flex-col gap-16">
      {years.map(year => (
        <YearGroup 
          year={year} 
          posts={contentByYear[year]}
          showIcon={true}
        />
      ))}
    </div>
    
  </Container>
</BaseLayout>