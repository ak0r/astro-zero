---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Container from '@/components/layout/Container.astro';
import PageHeader from '@/components/layout/PageHeader.astro';
import FilterTabs from '@/components/layout/FilterTabs.astro';
import YearGroup from '@/components/content/YearGroup.astro';
import { 
  getAllPosts, 
  sortPostsByDate, 
  getTopLevelPosts,
  getPostsByYearSorted 
} from '@/utils/getContent';
import { filterEntriesBy } from '@/utils/entries';
import { getBreadcrumbsFromPath } from '@/utils/commonFunctions';
import Breadcrumbs from '@/components/widgets/Breadcrumbs.astro';

export async function getStaticPaths() {
  return [
    { params: { category: 'travel' } },
    { params: { category: 'tech' } },
  ];
}

const { category } = Astro.params;

const allPosts = await getAllPosts();
const filteredPosts = filterEntriesBy(allPosts, 'category', category);
const sortedPosts = sortPostsByDate(filteredPosts);
const topLevelPosts = getTopLevelPosts(sortedPosts);

// Group by year
const postsByYear = await getPostsByYearSorted(topLevelPosts);
const nonEmptyYears = postsByYear.filter(([year, posts]) => posts.length > 0);

// Page metadata
const titles = {
  travel: 'Travel',
  tech: 'Tech',
};

const descriptions = {
  travel: 'Adventures and explorations around the world.',
  tech: 'Technical articles and coding insights.',
};

const filterTabs = [
  { label: 'All', href: '/posts', icon: 'layout-grid' },
  { label: 'Travel', href: '/posts/travel', icon: 'plane' },
  { label: 'Tech', href: '/posts/tech', icon: 'code' },
  { label: 'Galleries', href: '/galleries', icon: 'library-photo' },
];

// Generate breadcrumbs for the page
const breadcrumbs = getBreadcrumbsFromPath(Astro.url.pathname);
---

<BaseLayout>
  <Container class="py-8">
    
    <Breadcrumbs items={breadcrumbs} class="my-6" />

    <PageHeader
      title={titles[category]}
      description={descriptions[category]}
    />
    
    <FilterTabs tabs={filterTabs} class="mb-12" />
    
    <div class="flex flex-col gap-16">
      {nonEmptyYears.map(([year, posts]) => (
        <YearGroup 
          year={parseInt(year)} 
          entries={posts}
          showIcon={true}
        />
      ))}
    </div>
    
  </Container>
</BaseLayout>