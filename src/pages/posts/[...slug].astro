---
import type { Post } from "@/types";
import { getAllPosts } from '@/utils/getContent';
import PostLayout from '@/layouts/PostLayout.astro';

export async function getStaticPaths() {
  const allPosts = await getAllPosts();
  
  return allPosts.map(post => {
    // Clean the ID: remove date prefix, extension, and /index
    let slug = post.id
      .replace(/^\d{4}-\d{2}-\d{2}-/, '')  // Remove YYYY-MM-DD- prefix
      .replace(/\.(md|mdx)$/, '')          // Remove extension
      .replace('/index', '');               // Remove /index
    
    return {
      params: { slug },
      props: { post }
    };
  });
};

export interface Props {
  post: Post;
}
const { post } = Astro.props;

---
<PostLayout post={post} />
